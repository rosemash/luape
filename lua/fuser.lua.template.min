if#arg~=3 then print(("%s <luastub.bin> <source OR file:source.lua> <output.exe>"):format(arg[0]:match("^.+[/\\](.+)$")))return end;local b=""local function c(d,e,f)b=b..d:read(e)local g=0;for h in d:read(0x4):reverse():gmatch(".")do g=g*256+h:byte()end;g=g+f;print(("0x%.08x %d->%d"):format(d:seek()-4,g-f,g))for i=1,4 do b=b..("").char(g%256)g=g/256 end end;local j=arg[2]local k=j:match("^file:(.+)$")if k then local l=io.open(k,"r")j=l:read("*all")l:close()end;local m=io.open(arg[1],"rb")c(m,0x{o1:08x},#j)c(m,0x{o2:08x},#j)c(m,0x{o3:08x},#j)b=b..m:read("*all")..j;m:close()local n=io.open(arg[3],"wb")n:write(b)n:write(("\0"):rep({alignment:d}))n:close()print(("Wrote %d bytes to %q."):format(#b,arg[3]))
